#!/bin/bash
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# โ  ๐พ purpl35p4c3 โข herramienta ofensiva by l1ttl3bugc4t ๐    โ
# โ  script: multi_recon_sin_auth.sh                        โ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

#!/bin/bash

# Elaborado por Respuesta y Recuperaciรณn ๐ก๏ธ

BASE_URL=$1
shift
APPS=("$@")

WORDLIST="./aspnet_wordlist_extended.txt"
RESULT_DIR="resultados_pentest"

if [ -z "$BASE_URL" ] || [ ${#APPS[@]} -eq 0 ]; then
  echo "Uso: $0 <http(s)://IP_o_dominio> <carpeta1> <carpeta2> ..."
  exit 1
fi

if [ ! -f "$WORDLIST" ]; then
  echo "[!] No se encontrรณ la wordlist: $WORDLIST"
  exit 1
fi

mkdir -p "$RESULT_DIR"

for APP in "${APPS[@]}"; do
  echo "---------------------------------------------"
  echo "[*] Iniciando reconocimiento en carpeta: $APP"
  echo "URL: $BASE_URL/$APP/"
  echo "---------------------------------------------"

  FULL_URL="$BASE_URL/$APP"
  APP_DIR="$RESULT_DIR/$APP"
  mkdir -p "$APP_DIR"

  TMPDIR="$APP_DIR/tmp"
  OUTPUT="$APP_DIR/reporte_$APP.txt"
  mkdir -p "$TMPDIR"

  DATE=$(date)
  echo "REPORTE DE PENTEST AUTOMATIZADO - $DATE" > "$OUTPUT"
  echo "Aplicaciรณn: $FULL_URL" >> "$OUTPUT"
  echo "-----------------------------------------" >> "$OUTPUT"

  curl -s -I "$FULL_URL/" > "$TMPDIR/headers.txt"
  echo ">>> CABECERAS HTTP <<<" >> "$OUTPUT"
  grep -Ei 'Server:|X-Powered-By:|Set-Cookie|Location:' "$TMPDIR/headers.txt" >> "$OUTPUT"
  echo >> "$OUTPUT"

  curl -s -X OPTIONS -i "$FULL_URL/" > "$TMPDIR/options.txt"
  echo ">>> VERBOS HTTP SOPORTADOS <<<" >> "$OUTPUT"
  grep "Allow:" "$TMPDIR/options.txt" >> "$OUTPUT"
  echo >> "$OUTPUT"

  ffuf -u "$FULL_URL/FUZZ" -w "$WORDLIST" -mc 200,403 -t 40        -o "$TMPDIR/ffuf.json" -of json > /dev/null

  echo ">>> RUTAS DETECTADAS <<<" >> "$OUTPUT"
  jq -r '.results[] | "\(.url) [\(.status)]"' "$TMPDIR/ffuf.json" >> "$OUTPUT"
  echo >> "$OUTPUT"

  echo ">>> RUTAS ESPECIALES <<<" >> "$OUTPUT"
  for path in trace.axd elmah.axd debug.aspx web.config login.aspx; do
    STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$FULL_URL/$path")
    if [[ "$STATUS" == "200" || "$STATUS" == "403" ]]; then
      echo "$FULL_URL/$path [HTTP $STATUS]" >> "$OUTPUT"
    fi
  done
  echo >> "$OUTPUT"
  echo "[+] Reporte generado en: $OUTPUT"
done
