#!/bin/bash
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# โ  ๐พ purpl35p4c3 โข herramienta ofensiva by l1ttl3bugc4t ๐    โ
# โ  script: rpc_check.sh                                   โ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

#!/bin/bash

# Escaneo de RPC (puerto 135) y NetBIOS (puerto 139)
# Elaborado por Respuesta y Recuperaciรณn ๐ก๏ธ

TARGET=$1

if [ -z "$TARGET" ]; then
  echo "Uso: $0 <IP o dominio>"
  exit 1
fi

OUTPUT_DIR="rpc_recon_$TARGET"
mkdir -p "$OUTPUT_DIR"

REPORT="$OUTPUT_DIR/rpc_reporte.txt"
DATE=$(date)

echo "REPORTE DE ESCANEO RPC + NETBIOS - $DATE" > "$REPORT"
echo "Objetivo: $TARGET" >> "$REPORT"
echo "-----------------------------------------" >> "$REPORT"

# 1. Escaneo bรกsico de puertos 135 y 139
echo "[+] Escaneando puertos 135 y 139..."
nmap -Pn -p135,139 -sV "$TARGET" -oN "$OUTPUT_DIR/nmap_rpc_netbios.txt"
echo ">>> NMAP RPC/NETBIOS <<<" >> "$REPORT"
grep -Ei "135.*open|139.*open|msrpc|netbios" "$OUTPUT_DIR/nmap_rpc_netbios.txt" >> "$REPORT"
echo >> "$REPORT"

# 2. Enumeraciรณn de interfaces RPC con nmap
echo "[+] Enumerando interfaces RPC (nmap --script msrpc-enum)..."
nmap -Pn -p135 --script msrpc-enum "$TARGET" -oN "$OUTPUT_DIR/msrpc_enum.txt"
echo ">>> INTERFACES RPC DETECTADAS <<<" >> "$REPORT"
grep -Ei "uuid|binding|interface" "$OUTPUT_DIR/msrpc_enum.txt" | head -n 20 >> "$REPORT"
echo ">>> (ver archivo completo para mรกs informaciรณn)" >> "$REPORT"
echo >> "$REPORT"

# 3. Detecciรณn de vulnerabilidades RPC
echo "[+] Escaneando posibles vulnerabilidades RPC..."
nmap -Pn -p135 --script vuln "$TARGET" -oN "$OUTPUT_DIR/rpc_vuln.txt"
echo ">>> VULNERABILIDADES RPC <<<" >> "$REPORT"
grep -Ei "VULNERABLE|State: VULNERABLE|Exploitable" "$OUTPUT_DIR/rpc_vuln.txt" >> "$REPORT"
echo >> "$REPORT"

# 4. Uso de rpcdump.py si estรก disponible
if command -v rpcdump.py &>/dev/null; then
  echo "[+] Ejecutando rpcdump.py..."
  rpcdump.py @$TARGET > "$OUTPUT_DIR/rpcdump.txt" 2>/dev/null
  echo ">>> RPCDUMP.PY OUTPUT <<<" >> "$REPORT"
  grep -Ei "uuid|Interface|opnum" "$OUTPUT_DIR/rpcdump.txt" | head -n 15 >> "$REPORT"
  echo ">>> (ver archivo completo para mรกs info)" >> "$REPORT"
  echo >> "$REPORT"
else
  echo "[!] rpcdump.py (impacket) no estรก instalado o en el PATH." >> "$REPORT"
fi

# 5. Enumeraciรณn NetBIOS con nbtstat (si disponible)
echo "[+] Verificando NetBIOS con nbtscan..."
if command -v nbtscan &>/dev/null; then
  nbtscan "$TARGET" > "$OUTPUT_DIR/nbtscan.txt"
  echo ">>> NETBIOS NAMES (nbtscan) <<<" >> "$REPORT"
  cat "$OUTPUT_DIR/nbtscan.txt" >> "$REPORT"
  echo >> "$REPORT"
else
  echo "[!] nbtscan no estรก instalado. Saltando NetBIOS." >> "$REPORT"
fi

echo "[*] Reporte generado en: $REPORT"
cat "$REPORT"
